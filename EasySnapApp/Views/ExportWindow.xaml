<Window x:Class="EasySnapApp.Views.ExportWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Export Images - EasySnapApp" 
        Height="800" 
        Width="1200"
        MinHeight="600" 
        MinWidth="800"
        WindowStartupLocation="CenterOwner">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        
        <Style x:Key="GroupBoxHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Margin" Value="10,0"/>
        </Style>
        
        <Style x:Key="SettingsLabelStyle" TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
            <Setter Property="MinWidth" Value="80"/>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Main content area -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" MinWidth="400"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="1*" MinWidth="300"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel: Image List -->
            <GroupBox Grid.Column="0" Header="Images" Margin="0,0,5,0">
                <GroupBox.HeaderTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding}" Style="{StaticResource GroupBoxHeaderStyle}"/>
                    </DataTemplate>
                </GroupBox.HeaderTemplate>
                
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Selection Controls -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                        <Button Name="btnSelectAll" Content="Select All" Padding="10,5" Margin="0,0,5,0" Click="SelectAll_Click"/>
                        <Button Name="btnSelectNone" Content="Select None" Padding="10,5" Margin="0,0,10,0" Click="SelectNone_Click"/>
                        <TextBlock Text="Part Number:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <ComboBox Name="cmbPartNumbers" MinWidth="150" SelectionChanged="PartNumbers_SelectionChanged"/>
                    </StackPanel>

                    <!-- DataGrid -->
                    <DataGrid Grid.Row="1" Name="dgImages" 
                              AutoGenerateColumns="False" 
                              CanUserAddRows="False" 
                              CanUserDeleteRows="False"
                              CanUserReorderColumns="True"
                              CanUserResizeColumns="True"
                              CanUserSortColumns="True"
                              GridLinesVisibility="Horizontal"
                              AlternatingRowBackground="LightGray"
                              SelectionMode="Single"
                              SelectionUnit="FullRow"
                              SelectionChanged="DataGrid_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridCheckBoxColumn Binding="{Binding IsSelected}" Header="Select" Width="60"/>
                            <DataGridTextColumn Binding="{Binding PartNumber}" Header="Part Number" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Binding="{Binding Sequence}" Header="Seq" Width="60" IsReadOnly="True"/>
                            <DataGridTextColumn Binding="{Binding CaptureTimeUtc, StringFormat=yyyy-MM-dd HH:mm}" Header="Captured" Width="130" IsReadOnly="True"/>
                            <DataGridTextColumn Binding="{Binding FileSizeMB}" Header="Size" Width="80" IsReadOnly="True"/>
                            <DataGridTextColumn Binding="{Binding Weight, StringFormat=F2}" Header="Weight" Width="80" IsReadOnly="True"/>
                            <DataGridTextColumn Binding="{Binding DimensionsDisplay}" Header="Dimensions" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Binding="{Binding FileName}" Header="Filename" Width="*" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Status -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,10,0,0">
                        <TextBlock Name="lblImageCount" Text="0 images loaded" Margin="0,0,20,0"/>
                        <TextBlock Name="lblSelectedCount" Text="0 selected" FontWeight="SemiBold"/>
                    </StackPanel>
                </Grid>
            </GroupBox>

            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="LightGray"/>

            <!-- Right Panel: Preview and Export Settings -->
            <Grid Grid.Column="2" Margin="5,0,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="1*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="1*"/>
                </Grid.RowDefinitions>

                <!-- Preview Section -->
                <GroupBox Grid.Row="0" Header="Preview" Margin="0,0,0,5">
                    <GroupBox.HeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" Style="{StaticResource GroupBoxHeaderStyle}"/>
                        </DataTemplate>
                    </GroupBox.HeaderTemplate>
                    
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Image Preview -->
                        <Border Grid.Row="0" BorderBrush="Gray" BorderThickness="1" Margin="5">
                            <Image Name="imgPreview" 
                                   Stretch="Uniform" 
                                   StretchDirection="DownOnly"
                                   HorizontalAlignment="Center" 
                                   VerticalAlignment="Center"/>
                        </Border>

                        <!-- Metadata Display -->
                        <StackPanel Grid.Row="1" Margin="5">
                            <TextBlock Name="lblPreviewFileName" FontWeight="SemiBold" TextWrapping="Wrap"/>
                            <TextBlock Name="lblPreviewMetadata" FontSize="10" Foreground="Gray" TextWrapping="Wrap"/>
                        </StackPanel>
                    </Grid>
                </GroupBox>

                <GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="LightGray"/>

                <!-- Export Settings Section -->
                <GroupBox Grid.Row="2" Header="Export Settings" Margin="0,5,0,0">
                    <GroupBox.HeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" Style="{StaticResource GroupBoxHeaderStyle}"/>
                        </DataTemplate>
                    </GroupBox.HeaderTemplate>
                    
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="5">
                            <!-- Output Folder -->
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Output:" Style="{StaticResource SettingsLabelStyle}"/>
                                <TextBox Grid.Column="1" Name="txtOutputFolder" Margin="0,0,5,0" VerticalAlignment="Center" IsReadOnly="True"/>
                                <Button Grid.Column="2" Content="Browse..." Click="BrowseOutputFolder_Click" Padding="10,5"/>
                            </Grid>

                            <!-- Size Mode -->
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Size:" Style="{StaticResource SettingsLabelStyle}"/>
                                <ComboBox Grid.Column="1" Name="cmbSizeMode">
                                    <ComboBoxItem Content="Original Size" Tag="Original" IsSelected="True"/>
                                    <ComboBoxItem Content="Long Edge = N px" Tag="LongEdge"/>
                                    <ComboBoxItem Content="Fit inside W x H" Tag="FitInside"/>
                                </ComboBox>
                            </Grid>

                            <!-- Long Edge Setting -->
                            <Grid Margin="0,5" Name="pnlLongEdge" Visibility="Collapsed">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Long Edge:" Style="{StaticResource SettingsLabelStyle}"/>
                                <TextBox Grid.Column="1" Name="txtLongEdge" Text="1920" VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Fit Inside Settings -->
                            <Grid Margin="0,5" Name="pnlFitInside" Visibility="Collapsed">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Fit W:" Style="{StaticResource SettingsLabelStyle}"/>
                                <TextBox Grid.Column="1" Name="txtFitWidth" Text="1920" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <TextBlock Grid.Column="2" Text="H:" Style="{StaticResource SettingsLabelStyle}"/>
                                <TextBox Grid.Column="3" Name="txtFitHeight" Text="1080" VerticalAlignment="Center"/>
                            </Grid>

                            <!-- JPEG Quality -->
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Quality:" Style="{StaticResource SettingsLabelStyle}"/>
                                <Slider Grid.Column="1" Name="slQuality" Minimum="60" Maximum="100" Value="85" 
                                        TickFrequency="5" IsSnapToTickEnabled="True" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Name="lblQualityValue" Text="85%" MinWidth="40" 
                                           VerticalAlignment="Center" HorizontalAlignment="Right"/>
                            </Grid>

                            <!-- Options -->
                            <StackPanel Margin="0,5">
                                <CheckBox Name="chkCreateManifest" Content="Include manifest CSV" IsChecked="True" Margin="0,5"/>
                                <CheckBox Name="chkCreateZip" Content="Create ZIP archive" Margin="0,5"/>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </GroupBox>
            </Grid>
        </Grid>

        <!-- Progress Section -->
        <GroupBox Grid.Row="1" Header="Export Progress" Margin="0,10,0,0" Name="pnlProgress" Visibility="Collapsed">
            <StackPanel Margin="10">
                <TextBlock Name="lblProgressMessage" Text="Ready to export..." Margin="0,0,0,5"/>
                <ProgressBar Name="pbProgress" Height="20" Minimum="0" Maximum="100" Value="0"/>
            </StackPanel>
        </GroupBox>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Name="btnExportDims" Content="Export Dims CSV" Padding="15,8" Margin="0,0,10,0" 
                    Click="ExportDims_Click" IsEnabled="False" FontWeight="Normal"/>
            <Button Name="btnExport" Content="Export Selected" Padding="15,8" Margin="0,0,10,0" 
                    Click="Export_Click" IsEnabled="False" FontWeight="SemiBold"/>
            <Button Name="btnCancel" Content="Cancel" Padding="15,8" Click="Cancel_Click"/>
        </StackPanel>
    </Grid>
</Window>
