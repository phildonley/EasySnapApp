<Window x:Class="EasySnapApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="EasySnap"
        Height="900"
        Width="1400"
        Background="#1E1E22"
        Foreground="#F0F0F0"
        FontFamily="Segoe UI"
        FontSize="13"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <SolidColorBrush x:Key="HeaderBrush" Color="#FF888888"/>
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Foreground" Value="{StaticResource HeaderBrush}"/>
        </Style>
        <Style TargetType="MenuItem">
            <Setter Property="Foreground" Value="{StaticResource HeaderBrush}"/>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="0,0,0,6"/>
            <Setter Property="Padding" Value="6,4"/>
        </Style>
        <Style TargetType="Button">
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
        </Style>
    </Window.Resources>

    <DockPanel>

        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top"
              Background="#222"
              Foreground="#FAFAFA">
            <MenuItem Header="_File">
                <MenuItem Header="E_xit" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="_Edit"/>
            <MenuItem Header="_Settings">
                <MenuItem Header="DIMS Export Settings..." Click="OpenSettings_Click"/>
                <Separator/>
                <MenuItem Header="General Settings..." Click="GeneralSettings_Click"/>
                <Separator/>
                <MenuItem Header="Photography Tools..." Click="PhotographyTools_Click"/>
            </MenuItem>
            <MenuItem Header="_Export">
                <MenuItem Header="Export Images..." Click="OpenExportWindow_Click"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="About..." Click="About_Click"/>
            </MenuItem>
        </Menu>

        <!-- Status Bar -->
        <StatusBar DockPanel.Dock="Bottom" Background="#252526" Foreground="#F0F0F0">
            <TextBlock x:Name="StatusTextBlock"
                       Margin="8,0,0,0"
                       Foreground="#FF66FF66"
                       FontWeight="Bold"
                       FontSize="14"
                       Text="Ready."/>
        </StatusBar>

        <!-- Toolbar -->
        <ToolBar DockPanel.Dock="Top"
                 Background="#222"
                 Foreground="#FAFAFA"
                 Padding="4">
            <Label Content="Part Number:"
                   Foreground="#F0F0F0"
                   FontWeight="Bold"/>
            <TextBox x:Name="PartNumberTextBox"
                     Width="240"
                     Margin="4,0,16,0"/>
            <Button x:Name="NewButton"
                    Content="New"
                    Click="NewButton_Click"
                    Margin="0,0,8,0"/>
            <Button x:Name="CaptureButton"
                    Content="Capture"
                    Click="CaptureButton_Click"/>
        </ToolBar>

        <!-- Thumbnail Bar -->
        <Border DockPanel.Dock="Bottom"
                Height="110"
                Background="#18181A"
                BorderBrush="#353535"
                BorderThickness="1,1,1,0">
            <ScrollViewer HorizontalScrollBarVisibility="Auto"
                          VerticalScrollBarVisibility="Disabled"
                          Padding="8,6">
                <ItemsControl x:Name="ThumbnailBar">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="#444"
                                    BorderThickness="1"
                                    Margin="4"
                                    Background="#2A2A2E">
                                <StackPanel>
                                    <Image Source="{Binding ThumbnailImage}"
                                           Width="100"
                                           Height="80"
                                           Cursor="Hand"
                                           Stretch="UniformToFill"
                                           MouseLeftButtonUp="Thumbnail_MouseLeftButtonUp"/>
                                    <TextBlock Text="{Binding PartNumber}"
                                               FontSize="11"
                                               Foreground="#CCCCCC"
                                               Margin="6,4,6,0"/>
                                    <TextBlock Text="{Binding Sequence}"
                                               FontSize="11"
                                               Foreground="#AAAAAA"
                                               Margin="6,0,6,6"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>

        <!-- Main Content -->
        <Grid Margin="8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="320"/>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="4*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Devices/Services Drawer -->
            <Border Grid.Row="1"
                    Grid.Column="0"
                    Grid.ColumnSpan="3"
                    Margin="0,8,0,0"
                    BorderBrush="#555"
                    BorderThickness="1"
                    Background="#2A2A2E">
                <Expander x:Name="DevicesExpander"
                          Header="Devices / Services"
                          IsExpanded="False"
                          Foreground="#F0F0F0"
                          Background="#2A2A2E"
                          BorderThickness="0"
                          Padding="8">
                    <Grid Margin="8,4,8,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Camera Status -->
                        <TextBlock Grid.Row="0" Grid.Column="0"
                                   Text="Camera:"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,0"
                                   FontWeight="Bold"/>
                        <TextBlock x:Name="CameraStatusTextBlock"
                                   Grid.Row="0" Grid.Column="1"
                                   Text="Detecting..."
                                   VerticalAlignment="Center"
                                   Foreground="#FFAA66"
                                   Margin="0,0,8,0"/>
                        <Button x:Name="RefreshCameraButton"
                                Grid.Row="0" Grid.Column="2"
                                Content="Refresh"
                                Width="80"
                                Margin="0,0,8,0"
                                Click="RefreshCameraButton_Click"/>

                        <!-- Scale Configuration -->
                        <TextBlock Grid.Row="1" Grid.Column="0"
                                   Text="Scale COM Port:"
                                   VerticalAlignment="Center"
                                   Margin="0,8,8,0"
                                   FontWeight="Bold"/>
                        <ComboBox x:Name="ComPortComboBox"
                                  Grid.Row="1" Grid.Column="1"
                                  Width="120"
                                  Margin="0,8,8,0"
                                  SelectionChanged="ComPortComboBox_SelectionChanged"/>
                        <Button x:Name="RefreshPortsButton"
                                Grid.Row="1" Grid.Column="2"
                                Content="Refresh"
                                Width="80"
                                Margin="0,8,8,0"
                                Click="RefreshPortsButton_Click"/>
                        <TextBlock x:Name="ScaleStatusTextBlock"
                                   Grid.Row="1" Grid.Column="3"
                                   Text="Not configured"
                                   VerticalAlignment="Center"
                                   Foreground="#FFAA66"
                                   Margin="0,8,8,0"/>
                        <Button x:Name="TestScaleButton"
                                Grid.Row="1" Grid.Column="4"
                                Content="Test Scale"
                                Width="80"
                                Margin="0,8,0,0"
                                Click="TestScaleButton_Click"/>

                        <!-- Export Settings -->
                        <TextBlock Grid.Row="2" Grid.Column="0"
                                   Text="Export Units:"
                                   VerticalAlignment="Center"
                                   Margin="0,8,8,0"
                                   FontWeight="Bold"/>
                        <StackPanel Grid.Row="2" Grid.Column="1"
                                    Grid.ColumnSpan="2"
                                    Orientation="Horizontal"
                                    Margin="0,8,0,0">
                            <TextBlock Text="Dim:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                            <ComboBox x:Name="DimUnitComboBox"
                                      Width="60"
                                      Margin="0,0,12,0"
                                      SelectionChanged="ExportSettings_Changed">
                                <ComboBoxItem Content="in" IsSelected="True"/>
                                <ComboBoxItem Content="cm"/>
                            </ComboBox>
                            <TextBlock Text="Wgt:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                            <ComboBox x:Name="WgtUnitComboBox"
                                      Width="60"
                                      Margin="0,0,12,0"
                                      SelectionChanged="ExportSettings_Changed">
                                <ComboBoxItem Content="lb" IsSelected="True"/>
                                <ComboBoxItem Content="kg"/>
                            </ComboBox>
                            <TextBlock Text="Site:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                            <TextBox x:Name="SiteIdTextBox"
                                     Width="60"
                                     Text="733"
                                     TextChanged="ExportSettings_Changed"/>
                        </StackPanel>

                        <!-- Device Status Summary -->
                        <TextBlock Grid.Row="3" Grid.Column="0"
                                   Grid.ColumnSpan="5"
                                   x:Name="DeviceStatusSummary"
                                   Text="Camera: Detecting...  |  Scale: Not configured"
                                   Foreground="#CCCCCC"
                                   FontSize="11"
                                   Margin="0,8,0,0"/>
                    </Grid>
                </Expander>
            </Border>

            <!-- Left Pane: Manual Part Data -->
            <Border Grid.Row="0"
                    Grid.Column="0"
                    Margin="0,0,8,0"
                    BorderBrush="#444"
                    BorderThickness="1"
                    Background="#2A2A2E"
                    Padding="12">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>

                        <TextBlock Text="Part Data"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   Margin="0,0,0,10"/>

                        <TextBlock Text="Weight (lb)" FontWeight="Bold"/>
                        <DockPanel LastChildFill="False" Margin="0,6,0,10">
                            <TextBox x:Name="WeightTextBox" Width="120" DockPanel.Dock="Left" Margin="0,0,8,0"/>
                            <Button x:Name="CaptureWeightButton"
                                    Content="Capture"
                                    Click="CaptureWeightButton_Click"
                                    Width="90"/>
                        </DockPanel>

                        <TextBlock Text="Dims (in)" FontWeight="Bold"/>
                        <TextBlock Text="Length" Margin="0,6,0,2"/>
                        <TextBox x:Name="LengthTextBox"/>

                        <TextBlock Text="Width" Margin="0,6,0,2"/>
                        <TextBox x:Name="WidthTextBox"/>

                        <TextBlock Text="Height" Margin="0,6,0,2"/>
                        <TextBox x:Name="HeightTextBox"/>

                        <Button x:Name="ApplyPartDataButton"
                                Content="Apply to Part"
                                Click="ApplyPartDataButton_Click"
                                Height="34"
                                Margin="0,8,0,6"/>

                        <Separator Margin="0,10,0,10"/>

                        <TextBlock Text="Notes" FontWeight="Bold"/>
                        <TextBox x:Name="NotesTextBox"
                                 Height="110"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"/>

                        <Button x:Name="ExportCsvButton"
                                Content="Export CSV"
                                Click="ExportCsvButton_Click"
                                Height="36"
                                Margin="0,12,0,6"/>

                        <!-- Session Log Panel -->
                        <Separator Margin="0,10,0,10"/>
                        <TextBlock Text="Session Log"
                                   FontSize="14"
                                   FontWeight="Bold"
                                   Margin="0,0,0,6"/>
                        <Border Background="#1E1E22"
                                BorderBrush="#555"
                                BorderThickness="1"
                                Height="120">
                            <ScrollViewer x:Name="LogScrollViewer"
                                          VerticalScrollBarVisibility="Auto"
                                          HorizontalScrollBarVisibility="Auto"
                                          Padding="4">
                                <TextBox x:Name="SessionLogTextBox"
                                         FontSize="11"
                                         Foreground="#CCCCCC"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         FontFamily="Consolas"
                                         TextWrapping="NoWrap"
                                         IsReadOnly="True"
                                         AcceptsReturn="True"
                                         VerticalScrollBarVisibility="Auto"
                                         HorizontalScrollBarVisibility="Auto"
                                         Text="Ready.">
                                    <TextBox.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="Copy All" Click="CopyAllLog_Click"/>
                                            <MenuItem Header="Copy Selected" Click="CopySelectedLog_Click"/>
                                        </ContextMenu>
                                    </TextBox.ContextMenu>
                                </TextBox>
                            </ScrollViewer>
                        </Border>

                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- Center Pane: Photo Preview -->
            <Border Grid.Row="0"
                    Grid.Column="1"
                    Margin="0,0,8,0"
                    BorderBrush="#444"
                    BorderThickness="1"
                    Background="#2A2A2E"
                    Padding="6">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="#1E1E22" BorderBrush="#333" BorderThickness="1">
                        <Image x:Name="PreviewImage"
                               Stretch="Uniform"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"/>
                    </Border>

                    <StackPanel Grid.Row="1" Margin="0,8,0,0">
                        <TextBlock x:Name="PreviewMetaTextBlock"
                                   Text=""
                                   Foreground="#CCCCCC"
                                   FontSize="12"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Right Pane: Results Table -->
            <Border Grid.Row="0"
                    Grid.Column="2"
                    BorderBrush="#404040"
                    BorderThickness="1"
                    Background="#23272D"
                    Padding="4">
                <DataGrid x:Name="SessionDataGrid"
                          AutoGenerateColumns="False"
                          HeadersVisibility="Column"
                          IsReadOnly="True"
                          CanUserAddRows="False"
                          GridLinesVisibility="None"
                          SelectionChanged="SessionDataGrid_SelectionChanged"
                          Background="#23272D"
                          Foreground="#FAFAFA"
                          RowBackground="#23272D"
                          AlternatingRowBackground="#252526"
                          ColumnHeaderHeight="30"
                          RowHeight="28"
                          FontSize="13">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Part Number"
                                            Binding="{Binding PartNumber}"
                                            Width="*"/>
                        <DataGridTextColumn Header="Seq"
                                            Binding="{Binding Sequence}"
                                            Width="70"/>
                        <DataGridTextColumn Header="File"
                                            Binding="{Binding ImageFileName}"
                                            Width="2*"/>
                        <DataGridTextColumn Header="Timestamp"
                                            Binding="{Binding TimeStamp}"
                                            Width="*"/>
                        <DataGridTextColumn Header="Length (in)"
                                            Binding="{Binding LengthIn, StringFormat={}{0:F2}}"
                                            Width="90"/>
                        <!-- Using DepthIn as Width for now to avoid breaking your model -->
                        <DataGridTextColumn Header="Width (in)"
                                            Binding="{Binding DepthIn, StringFormat={}{0:F2}}"
                                            Width="90"/>
                        <DataGridTextColumn Header="Height (in)"
                                            Binding="{Binding HeightIn, StringFormat={}{0:F2}}"
                                            Width="90"/>
                        <DataGridTextColumn Header="Weight (lb)"
                                            Binding="{Binding WeightLb, StringFormat={}{0:F2}}"
                                            Width="90"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>

        </Grid>
    </DockPanel>
</Window>